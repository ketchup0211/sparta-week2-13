<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineWave</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,200,0,-25" />
    <link rel="stylesheet" href="./style/deatilPage.css">
</head>

<body>
    <header>
        <h1><a href="./index.html">CineWave</a></h1>
        <p><input type="search" placeholder="영화를 검색하세요."><span class="material-symbols-outlined">search</span></p>
    </header>
    <main>
        <section class="info">
            <div class="back_img"></div>

            <article class="movie_info">
                <h3>The Dark Knight</h3>
                <p class="release_data">2008.07.18</p>
                <p class="rating">8.245</p>
                <p class="summary">Batman raises the stakes in his war on crime. With the help of Lt. Jim Gordon and
                    District Attorney Harvey Dent, Batman sets out to dismantle the remaining criminal organizations
                    that plague the streets. The partnership proves to be effective, but they soon find themselves prey
                    to a reign of chaos unleashed by a rising criminal mastermind known to the terrified citizens of
                    Gotham as the Joker.</p>
            </article>
            <article class="poster">
                <img src="https://i.namu.wiki/i/pYns0gcNCbTD7yp7dBRbNHhyFFTf3cadcVNOZYX_mfZ686xhaDpqn2wKHBvcMMxlymTmdtRMmfe_I9xnTGhN2wVFo-NPvpbyV1LvOecPITKSSGF7m7ALWfaIKAqeWJXBU1RZV1AVLLSeDeTCXd5ELA.webp"
                    alt="">
            </article>

        </section>
        <section class="review">
            <h4>review</h4>
            <div>
                <article class="review_input">
                    <form id="reviewForm" action="">
                        <input type="text" id="userName" placeholder="작성자">
                        <input type="password" id="password" placeholder="비밀번호">
                        <input type="text" id="reviewWrite" placeholder="리뷰를 작성해주세요.">
                        <button id="writeBtn">작성</button>
                    </form>
                </article>
                <article id="reviewOutput" class="review_output">
                    <!-- <div class="review_box">
                        <p class="output_Name">홍길동</p>
                        <p class="output_Review">리뷰쓴다- 하하하하</p>
                        <button id="removeBtn">삭제</button>
                    </div> -->
                </article>
            </div>
        </section>
    </main>
    <footer></footer>

    <script>
        window.onload = function () {
            loadReviews();

            document.addEventListener("click", function (e) {
                if (e.target && e.target.id == "removeBtn") {
                    e.preventDefault();
                    // 클릭된 삭제 버튼의 부모 요소인 review_box를 찾음
                    const reviewBox = e.target.closest(".review_box");

                    // review_box에서 user 정보를 가져와 해당 리뷰를 삭제
                    const userName = reviewBox.querySelector(".output_Name").textContent;
                    removeReview(userName);

                    // 삭제 후 리뷰 다시 로드
                    loadReviews();
                }
            });
        };

        document.getElementById("writeBtn").addEventListener("click", function (e) {
            e.preventDefault();

            const inputName = document.getElementById("userName").value;
            const inputPass = document.getElementById("password").value;
            const inputReview = document.getElementById("reviewWrite").value;

            let newReview = {
                user: inputName,
                password: inputPass,
                userReview: inputReview,
            };

            let reviews = getReviews();

            reviews.push(newReview);

            localStorage.setItem('inputReview', JSON.stringify(reviews));

            loadReviews();

            document.getElementById('reviewForm').reset();

        })

        function getReviews() {
            let reviews = localStorage.getItem('inputReview');

            if (reviews) {
                return JSON.parse(reviews);
            } else {
                return [];
            }
        }

        function loadReviews() {
            let reviewList = document.getElementById('reviewOutput');
            reviewList.innerHTML = '';

            let reviews = getReviews();

            for (let i = 0; i < reviews.length; i++) {
                let review = reviews[i];

                let newReviewWrite = document.createElement("div")
                let temp = document.querySelector(".review_output");
                let divReviewBox = temp.appendChild(newReviewWrite)
                divReviewBox.setAttribute("class", "review_box");
                divReviewBox.innerHTML = `
                    <p class="output_Name">${review.user}</p>
                    <p class="output_Review">${review.userReview}</p>
                    <button id="removeBtn">삭제</button>
                `
                reviewList.appendChild(divReviewBox);
            }

        }
        function removeReview(userName) {
            let reviews = getReviews();

            // userName이 일치하는 리뷰를 찾아 제거
            reviews = reviews.filter(review => review.user !== userName);

            localStorage.setItem('inputReview', JSON.stringify(reviews));
        }

    </script>
</body>

</html>